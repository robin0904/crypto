<!DOCTYPE html>
<html>
<head>
<title>Crypto Detail</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
body{
 background:#05060a;
 color:#fff;
 font-family:Poppins;
 margin:0;
 padding:0;
 overflow-x:hidden;
}

/* wrapper */
.mainArea{
 display:flex;
 margin-top:20px;
 justify-content:center;
 align-items:flex-start;
 gap:25px;
}

/* left & right news panels */
.newsPanel{
 width:260px;
 height:600px;
 overflow:hidden;
 border-radius:16px;
 background:rgba(255,255,255,.04);
 border:1px solid rgba(255,255,255,.2);
 backdrop-filter:blur(10px);
 position:relative;
}
.newsInner{
 position:absolute;
 width:100%;
 animation:scrollNews 40s linear infinite;
}
.newsItem{
 padding:12px;
 border-bottom:1px solid rgba(255,255,255,.08);
 cursor:pointer;
 line-height:1.5;
}
.newsItem:hover{
 background:rgba(255,255,255,.12);
}
.newsBadge{
 font-size:10px;
 background:linear-gradient(45deg,#ff0055,#ff6600);
 padding:2px 5px;
 border-radius:4px;
 margin-right:6px;
}
.newsDate{
 font-size:10px;
 opacity:.7;
}

/* infinite slower & smooth loop */
@keyframes scrollNews{
 0%{top:0}
 100%{top:-200%}
}

/* center panel */
.centerBox{
 width:820px;
 padding:20px;
 background:rgba(255,255,255,.06);
 backdrop-filter:blur(10px);
 border-radius:16px;
 border:1px solid rgba(255,255,255,.2);
}

/* chart */
.chartArea{
 margin-top:15px;
}

.green{color:#4aff4a;}
.red{color:#ff5757;}
</style>
</head>

<body>

<div class="mainArea">

 <!-- LEFT NEWS -->
 <div class="newsPanel">
   <div class="newsInner" id="newsLeft"></div>
 </div>

 <!-- CENTER -->
 <div class="centerBox">
   <h1 id="name"></h1>
   <img id="logo" width="60"/>

   <h2 id="price"></h2>
   <div id="change"></div>
   <br>
   <div id="yesterday"></div>
   <div id="high"></div>
   <div id="low"></div>
   <br>
   <div id="recommend"></div>

   <h2>Live Chart</h2>
   <div class="chartArea" id="chart"></div>
 </div>

 <!-- RIGHT NEWS -->
 <div class="newsPanel">
   <div class="newsInner" id="newsRight"></div>
 </div>

</div>


<script>
async function load(){
 let params=new URLSearchParams(location.search)
 let id=params.get("id")

 let res1=await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=inr&ids=${id}`)
 let c=(await res1.json())[0]

 document.getElementById("name").innerHTML=c.name
 document.getElementById("price").innerHTML="â‚¹ "+c.current_price.toLocaleString()
 document.getElementById("change").innerHTML=c.price_change_percentage_24h.toFixed(2)+"%"
 document.getElementById("logo").src=c.image

 // history
 let res2=await fetch(`https://api.coingecko.com/api/v3/coins/${id}/market_chart?vs_currency=inr&days=2`)
 let hist=await res2.json()

 let yesterday=hist.prices[0][1]
 document.getElementById("yesterday").innerHTML="Yesterday: â‚¹ "+Math.round(yesterday).toLocaleString()

 let last=hist.prices[hist.prices.length-1][1]
 if(last > yesterday){
   document.getElementById("recommend").innerHTML="<span class='green'>Higher than yesterday â€” Bullish</span>"
 }else{
   document.getElementById("recommend").innerHTML="<span class='red'>Below yesterday â€” Bearish</span>"
 }

 document.getElementById("high").innerHTML="24h High: â‚¹ "+c.high_24h.toLocaleString()
 document.getElementById("low").innerHTML="24h Low: â‚¹ "+c.low_24h.toLocaleString()

 document.getElementById("chart").innerHTML=
 `<iframe width="100%" height="420" frameborder="0"
  src="https://s.tradingview.com/widgetembed/?symbol=${c.symbol.toUpperCase()}USD&interval=60&theme=dark"></iframe>`

 loadNewsPanels(id)
}


/* converting date nice format */
function timeAgo(dateStr){
 let date=new Date(dateStr)
 let now=new Date()
 let diff=(now-date)/1000/60/60/24
 if(diff<1) return "Today"
 if(diff<2) return "Yesterday"
 return date.toLocaleDateString()
}

// NEWS
async function loadNewsPanels(keyword){
 try{
   let res=await fetch(`https://cryptopanic.com/news/rss/?q=${keyword}`)
   let text=await res.text()

   let parser=new DOMParser()
   let xml=parser.parseFromString(text,"text/xml")
   let items=xml.getElementsByTagName("item")

   let leftHTML="", rightHTML=""

   for(let i=0;i<items.length;i++){
     let item=items[i]
     let title=item.getElementsByTagName("title")[0]?.textContent || ""
     let link=item.getElementsByTagName("link")[0]?.textContent || ""
     let date=item.getElementsByTagName("pubDate")[0]?.textContent || ""

     let tag = i===0 ? "LATEST ðŸ”¥" : timeAgo(date)

     let row=`
       <div class="newsItem" onclick="window.open('${link}','_blank')">
         <span class="newsBadge">${tag}</span> ${title}
         <div class="newsDate">${date}</div>
       </div>
     `

     if(i % 2 === 0) leftHTML += row
     else rightHTML += row
   }

   document.getElementById("newsLeft").innerHTML=leftHTML
   document.getElementById("newsRight").innerHTML=rightHTML

 }catch(e){}
}

load()
</script>

</body>
</html>
